{
  "hash": "390ba7aa90050296108338901a4f9f76",
  "result": {
    "markdown": "---\ntitle: \"Tidymodels\"\nauthor: \"Gustavo Bruges\"\ndate: \"2022-12-27\"\ncategories: [code]\nimage: \"image.jpg\"\n---\n\n\n## Machine Learning con Tidymodels\n\n### Introducción a los k-vecinos más cercanos\n\nEn essta sección aprenderemos sobre la clasificación mediante k-NN (vecinos más cercanos cercanos). A diferencia de muchos algoritmos de clasificación, k-nearest neighbors no realiza ningún aprendizaje. Simplemente almacena los datos de entrenamiento textualmente. Los ejemplos de prueba sin etiquetar se emparejan con los con los registros más similares del conjunto de entrenamiento mediante una función de distancia, y al ejemplo sin etiquetar se le asigna la etiqueta de sus vecinos.\n\nA pesar de que k-NN es un algoritmo muy sencillo, es capaz de abordar\n\ntareas extremadamente complejas, como la identificación de masas cancerosas.\n\nA pesar de la simplicidad de esta idea, los métodos de vecino más cercano son extremadamente potentes. Se han utilizado con éxito para:\n\n\\- Aplicaciones de visión por ordenador, como el reconocimiento óptico de caracteres y reconocimiento facial, tanto en imágenes fijas como en vídeo\n\n\\- Sistemas de recomendación que predicen si a una persona le gustará una película o una canción\n\n\\- Identificación de patrones en datos genéticos para detectar proteínas o enfermedades específicas.\n\nEn general, los clasificadores por vecino más próximo (k-NN) son adecuados para tareas de clasificación en las que las relaciones entre las características y las clases objetivo son numerosas, complicadas o extremadamente difíciles de entender, pero los elementos de clases similares tienden a ser bastante homogéneos.\n\n## Cargar paquetes \n\n------------------------------------------------------------------------\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidymodels)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ────────────────────────────────────── tidymodels 1.0.0 ──\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n✔ broom        1.0.0     ✔ recipes      1.0.1\n✔ dials        1.0.0     ✔ rsample      1.0.0\n✔ dplyr        1.0.9     ✔ tibble       3.1.8\n✔ ggplot2      3.3.6     ✔ tidyr        1.2.0\n✔ infer        1.0.2     ✔ tune         1.0.0\n✔ modeldata    1.0.1     ✔ workflows    1.0.0\n✔ parsnip      1.0.0     ✔ workflowsets 1.0.0\n✔ purrr        0.3.4     ✔ yardstick    1.0.0\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──\n✖ purrr::discard() masks scales::discard()\n✖ dplyr::filter()  masks stats::filter()\n✖ dplyr::lag()     masks stats::lag()\n✖ recipes::step()  masks stats::step()\n• Dig deeper into tidy modeling with R at https://www.tmwr.org\n```\n:::\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages\n───────────────────────────────────────\ntidyverse 1.3.2 ──\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n✔ readr   2.1.2     ✔ forcats 0.5.1\n✔ stringr 1.5.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ readr::col_factor() masks scales::col_factor()\n✖ purrr::discard()    masks scales::discard()\n✖ dplyr::filter()     masks stats::filter()\n✖ stringr::fixed()    masks recipes::fixed()\n✖ dplyr::lag()        masks stats::lag()\n✖ readr::spec()       masks yardstick::spec()\n```\n:::\n\n```{.r .cell-code}\nlibrary(janitor)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'janitor'\n\nThe following objects are masked from 'package:stats':\n\n    chisq.test, fisher.test\n```\n:::\n\n```{.r .cell-code}\nlibrary(skimr)\nlibrary(GGally)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRegistered S3 method overwritten by 'GGally':\n  method from   \n  +.gg   ggplot2\n```\n:::\n:::\n\n\n### Datos de wisconsin data set:\n\nEl examen sistemático del cáncer de mama permite diagnosticar y tratar la enfermedad antes de que cause síntomas perceptibles. El proceso de detección precoz consiste en examinar el tejido mamario en busca de bultos o masas anormales. Si se detecta un bulto, se realiza una biopsia por aspiración con aguja fina, en la que se utiliza una aguja hueca para extraer una pequeña muestra de células de la masa. A continuación, el personal de salud examina las células al microscopio para determinar si la masa puede ser maligna o benigna.\n\nSi el aprendizaje automático pudiera automatizar la identificación de células cancerosas, supondría un beneficio considerable para el sistema sanitario.\n\nEs probable que los procesos automatizados de detección, lo que permitiría a los médicos dedicar menos tiempo al diagnóstico y más al tratamiento.\n\nA continuación veremos un plantearemos el algoritmo k-NN en el diánostico de cáncer de mama de muestras provenientes de Breast Cancer Wisconsin\n<http://archive.ics.uci.edu/ml.>\n\n### Carga de los datos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwbc <- read_csv(\"https://raw.githubusercontent.com/rspanhol/wisconsin-breast-cancer/main/wisconsin.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nNew names:\n• `` -> `...33`\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: One or more parsing issues, see `problems()` for details\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 568 Columns: 33\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (1): diagnosis\ndbl (31): id, radius_mean, texture_mean, perimeter_mean, area_mean, smoothne...\nlgl  (1): ...33\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\n#Visionado de los datos\nglimpse(wbc)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 568\nColumns: 33\n$ id                      <dbl> 842302, 842517, 84300903, 84348301, 84358402, …\n$ diagnosis               <chr> \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"…\n$ radius_mean             <dbl> 17.990, 20.570, 19.690, 11.420, 20.290, 12.450…\n$ texture_mean            <dbl> 10.38, 17.77, 21.25, 20.38, 14.34, 15.70, 19.9…\n$ perimeter_mean          <dbl> 122.80, 132.90, 130.00, 77.58, 135.10, 82.57, …\n$ area_mean               <dbl> 1001.0, 1326.0, 1203.0, 386.1, 1297.0, 477.1, …\n$ smoothness_mean         <dbl> 0.11840, 0.08474, 0.10960, 0.14250, 0.10030, 0…\n$ compactness_mean        <dbl> 0.27760, 0.07864, 0.15990, 0.28390, 0.13280, 0…\n$ concavity_mean          <dbl> 0.30010, 0.08690, 0.19740, 0.24140, 0.19800, 0…\n$ `concave points_mean`   <dbl> 0.14710, 0.07017, 0.12790, 0.10520, 0.10430, 0…\n$ symmetry_mean           <dbl> 0.2419, 0.1812, 0.2069, 0.2597, 0.1809, 0.2087…\n$ fractal_dimension_mean  <dbl> 0.07871, 0.05667, 0.05999, 0.09744, 0.05883, 0…\n$ radius_se               <dbl> 1.0950, 0.5435, 0.7456, 0.4956, 0.7572, 0.3345…\n$ texture_se              <dbl> 0.9053, 0.7339, 0.7869, 1.1560, 0.7813, 0.8902…\n$ perimeter_se            <dbl> 8.589, 3.398, 4.585, 3.445, 5.438, 2.217, 3.18…\n$ area_se                 <dbl> 153.40, 74.08, 94.03, 27.23, 94.44, 27.19, 53.…\n$ smoothness_se           <dbl> 0.006399, 0.005225, 0.006150, 0.009110, 0.0114…\n$ compactness_se          <dbl> 0.049040, 0.013080, 0.040060, 0.074580, 0.0246…\n$ concavity_se            <dbl> 0.05373, 0.01860, 0.03832, 0.05661, 0.05688, 0…\n$ `concave points_se`     <dbl> 0.015870, 0.013400, 0.020580, 0.018670, 0.0188…\n$ symmetry_se             <dbl> 0.03003, 0.01389, 0.02250, 0.05963, 0.01756, 0…\n$ fractal_dimension_se    <dbl> 0.006193, 0.003532, 0.004571, 0.009208, 0.0051…\n$ radius_worst            <dbl> 25.38, 24.99, 23.57, 14.91, 22.54, 15.47, 22.8…\n$ texture_worst           <dbl> 17.33, 23.41, 25.53, 26.50, 16.67, 23.75, 27.6…\n$ perimeter_worst         <dbl> 184.60, 158.80, 152.50, 98.87, 152.20, 103.40,…\n$ area_worst              <dbl> 2019.0, 1956.0, 1709.0, 567.7, 1575.0, 741.6, …\n$ smoothness_worst        <dbl> 0.1622, 0.1238, 0.1444, 0.2098, 0.1374, 0.1791…\n$ compactness_worst       <dbl> 0.6656, 0.1866, 0.4245, 0.8663, 0.2050, 0.5249…\n$ concavity_worst         <dbl> 0.71190, 0.24160, 0.45040, 0.68690, 0.40000, 0…\n$ `concave points_worst`  <dbl> 0.26540, 0.18600, 0.24300, 0.25750, 0.16250, 0…\n$ symmetry_worst          <dbl> 0.4601, 0.2750, 0.3613, 0.6638, 0.2364, 0.3985…\n$ fractal_dimension_worst <dbl> 0.11890, 0.08902, 0.08758, 0.17300, 0.07678, 0…\n$ ...33                   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n```\n:::\n:::\n\n\n### Limpieza inicial de los datos\n\nSe proceden a eliminar columnas que son innecesarias para el análisis, el identificador id y la última columna que contiene solamente valores NA, además se hace una modificación para que la varaible diagnosis sea de tipo categórica. Adicionalmente se corrigen los nombres cortos de variables con clean_names de janitor\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwbc <- wbc[-c(1,33)]\nglimpse(wbc)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 568\nColumns: 31\n$ diagnosis               <chr> \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"…\n$ radius_mean             <dbl> 17.990, 20.570, 19.690, 11.420, 20.290, 12.450…\n$ texture_mean            <dbl> 10.38, 17.77, 21.25, 20.38, 14.34, 15.70, 19.9…\n$ perimeter_mean          <dbl> 122.80, 132.90, 130.00, 77.58, 135.10, 82.57, …\n$ area_mean               <dbl> 1001.0, 1326.0, 1203.0, 386.1, 1297.0, 477.1, …\n$ smoothness_mean         <dbl> 0.11840, 0.08474, 0.10960, 0.14250, 0.10030, 0…\n$ compactness_mean        <dbl> 0.27760, 0.07864, 0.15990, 0.28390, 0.13280, 0…\n$ concavity_mean          <dbl> 0.30010, 0.08690, 0.19740, 0.24140, 0.19800, 0…\n$ `concave points_mean`   <dbl> 0.14710, 0.07017, 0.12790, 0.10520, 0.10430, 0…\n$ symmetry_mean           <dbl> 0.2419, 0.1812, 0.2069, 0.2597, 0.1809, 0.2087…\n$ fractal_dimension_mean  <dbl> 0.07871, 0.05667, 0.05999, 0.09744, 0.05883, 0…\n$ radius_se               <dbl> 1.0950, 0.5435, 0.7456, 0.4956, 0.7572, 0.3345…\n$ texture_se              <dbl> 0.9053, 0.7339, 0.7869, 1.1560, 0.7813, 0.8902…\n$ perimeter_se            <dbl> 8.589, 3.398, 4.585, 3.445, 5.438, 2.217, 3.18…\n$ area_se                 <dbl> 153.40, 74.08, 94.03, 27.23, 94.44, 27.19, 53.…\n$ smoothness_se           <dbl> 0.006399, 0.005225, 0.006150, 0.009110, 0.0114…\n$ compactness_se          <dbl> 0.049040, 0.013080, 0.040060, 0.074580, 0.0246…\n$ concavity_se            <dbl> 0.05373, 0.01860, 0.03832, 0.05661, 0.05688, 0…\n$ `concave points_se`     <dbl> 0.015870, 0.013400, 0.020580, 0.018670, 0.0188…\n$ symmetry_se             <dbl> 0.03003, 0.01389, 0.02250, 0.05963, 0.01756, 0…\n$ fractal_dimension_se    <dbl> 0.006193, 0.003532, 0.004571, 0.009208, 0.0051…\n$ radius_worst            <dbl> 25.38, 24.99, 23.57, 14.91, 22.54, 15.47, 22.8…\n$ texture_worst           <dbl> 17.33, 23.41, 25.53, 26.50, 16.67, 23.75, 27.6…\n$ perimeter_worst         <dbl> 184.60, 158.80, 152.50, 98.87, 152.20, 103.40,…\n$ area_worst              <dbl> 2019.0, 1956.0, 1709.0, 567.7, 1575.0, 741.6, …\n$ smoothness_worst        <dbl> 0.1622, 0.1238, 0.1444, 0.2098, 0.1374, 0.1791…\n$ compactness_worst       <dbl> 0.6656, 0.1866, 0.4245, 0.8663, 0.2050, 0.5249…\n$ concavity_worst         <dbl> 0.71190, 0.24160, 0.45040, 0.68690, 0.40000, 0…\n$ `concave points_worst`  <dbl> 0.26540, 0.18600, 0.24300, 0.25750, 0.16250, 0…\n$ symmetry_worst          <dbl> 0.4601, 0.2750, 0.3613, 0.6638, 0.2364, 0.3985…\n$ fractal_dimension_worst <dbl> 0.11890, 0.08902, 0.08758, 0.17300, 0.07678, 0…\n```\n:::\n:::\n\n\nLas 30 medidas numéricas comprenden la media, el error estándar y el peor valor (es decir, el mayor) de 10 características diferentes de los núcleos celulares digitalizados Estas incluyen:\n\n\\- Radio\n\n\\- Textura\n\n\\- Perímetro\n\n\\- Superficie\n\n\\- Suavidad\n\n\\- Compacidad\n\n\\- Concavidad\n\n\\- Puntos cóncavos\n\n\\- Simetría\n\n\\- Dimensión fractal\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Limpiar nombres de variables\nwbc <- wbc %>% clean_names()\nglimpse(wbc)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 568\nColumns: 31\n$ diagnosis               <chr> \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"…\n$ radius_mean             <dbl> 17.990, 20.570, 19.690, 11.420, 20.290, 12.450…\n$ texture_mean            <dbl> 10.38, 17.77, 21.25, 20.38, 14.34, 15.70, 19.9…\n$ perimeter_mean          <dbl> 122.80, 132.90, 130.00, 77.58, 135.10, 82.57, …\n$ area_mean               <dbl> 1001.0, 1326.0, 1203.0, 386.1, 1297.0, 477.1, …\n$ smoothness_mean         <dbl> 0.11840, 0.08474, 0.10960, 0.14250, 0.10030, 0…\n$ compactness_mean        <dbl> 0.27760, 0.07864, 0.15990, 0.28390, 0.13280, 0…\n$ concavity_mean          <dbl> 0.30010, 0.08690, 0.19740, 0.24140, 0.19800, 0…\n$ concave_points_mean     <dbl> 0.14710, 0.07017, 0.12790, 0.10520, 0.10430, 0…\n$ symmetry_mean           <dbl> 0.2419, 0.1812, 0.2069, 0.2597, 0.1809, 0.2087…\n$ fractal_dimension_mean  <dbl> 0.07871, 0.05667, 0.05999, 0.09744, 0.05883, 0…\n$ radius_se               <dbl> 1.0950, 0.5435, 0.7456, 0.4956, 0.7572, 0.3345…\n$ texture_se              <dbl> 0.9053, 0.7339, 0.7869, 1.1560, 0.7813, 0.8902…\n$ perimeter_se            <dbl> 8.589, 3.398, 4.585, 3.445, 5.438, 2.217, 3.18…\n$ area_se                 <dbl> 153.40, 74.08, 94.03, 27.23, 94.44, 27.19, 53.…\n$ smoothness_se           <dbl> 0.006399, 0.005225, 0.006150, 0.009110, 0.0114…\n$ compactness_se          <dbl> 0.049040, 0.013080, 0.040060, 0.074580, 0.0246…\n$ concavity_se            <dbl> 0.05373, 0.01860, 0.03832, 0.05661, 0.05688, 0…\n$ concave_points_se       <dbl> 0.015870, 0.013400, 0.020580, 0.018670, 0.0188…\n$ symmetry_se             <dbl> 0.03003, 0.01389, 0.02250, 0.05963, 0.01756, 0…\n$ fractal_dimension_se    <dbl> 0.006193, 0.003532, 0.004571, 0.009208, 0.0051…\n$ radius_worst            <dbl> 25.38, 24.99, 23.57, 14.91, 22.54, 15.47, 22.8…\n$ texture_worst           <dbl> 17.33, 23.41, 25.53, 26.50, 16.67, 23.75, 27.6…\n$ perimeter_worst         <dbl> 184.60, 158.80, 152.50, 98.87, 152.20, 103.40,…\n$ area_worst              <dbl> 2019.0, 1956.0, 1709.0, 567.7, 1575.0, 741.6, …\n$ smoothness_worst        <dbl> 0.1622, 0.1238, 0.1444, 0.2098, 0.1374, 0.1791…\n$ compactness_worst       <dbl> 0.6656, 0.1866, 0.4245, 0.8663, 0.2050, 0.5249…\n$ concavity_worst         <dbl> 0.71190, 0.24160, 0.45040, 0.68690, 0.40000, 0…\n$ concave_points_worst    <dbl> 0.26540, 0.18600, 0.24300, 0.25750, 0.16250, 0…\n$ symmetry_worst          <dbl> 0.4601, 0.2750, 0.3613, 0.6638, 0.2364, 0.3985…\n$ fractal_dimension_worst <dbl> 0.11890, 0.08902, 0.08758, 0.17300, 0.07678, 0…\n```\n:::\n\n```{.r .cell-code}\n#Convertir variable diagnosis a categóricas\n\nwbc <- wbc %>% \n         mutate(diagnosis = factor(diagnosis))\n\nwbc <- wbc %>% \n  mutate(diagnosis = fct_relevel(diagnosis, \"M\"))\n\nwbc %>% count(diagnosis)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 2\n  diagnosis     n\n  <fct>     <int>\n1 M           212\n2 B           356\n```\n:::\n:::\n\n\n### Análisis Exploratorio de los datos\n\nUsamos skim() de skimr para una estadística univariada de los datos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nskim(wbc)\n```\n\n::: {.cell-output-display}\nTable: Data summary\n\n|                         |     |\n|:------------------------|:----|\n|Name                     |wbc  |\n|Number of rows           |568  |\n|Number of columns        |31   |\n|_______________________  |     |\n|Column type frequency:   |     |\n|factor                   |1    |\n|numeric                  |30   |\n|________________________ |     |\n|Group variables          |None |\n\n\n**Variable type: factor**\n\n|skim_variable | n_missing| complete_rate|ordered | n_unique|top_counts     |\n|:-------------|---------:|-------------:|:-------|--------:|:--------------|\n|diagnosis     |         0|             1|FALSE   |        2|B: 356, M: 212 |\n\n\n**Variable type: numeric**\n\n|skim_variable           | n_missing| complete_rate|   mean|     sd|     p0|    p25|    p50|     p75|    p100|hist  |\n|:-----------------------|---------:|-------------:|------:|------:|------:|------:|------:|-------:|-------:|:-----|\n|radius_mean             |         0|             1|  14.14|   3.52|   6.98|  11.71|  13.38|   15.80|   28.11|▂▇▃▁▁ |\n|texture_mean            |         0|             1|  19.28|   4.30|   9.71|  16.17|  18.84|   21.78|   39.28|▃▇▃▁▁ |\n|perimeter_mean          |         0|             1|  92.05|  24.25|  43.79|  75.20|  86.29|  104.15|  188.50|▃▇▃▁▁ |\n|area_mean               |         0|             1| 655.72| 351.66| 143.50| 420.30| 551.40|  784.15| 2501.00|▇▃▂▁▁ |\n|smoothness_mean         |         0|             1|   0.10|   0.01|   0.06|   0.09|   0.10|    0.11|    0.16|▂▇▅▁▁ |\n|compactness_mean        |         0|             1|   0.10|   0.05|   0.02|   0.07|   0.09|    0.13|    0.35|▇▇▂▁▁ |\n|concavity_mean          |         0|             1|   0.09|   0.08|   0.00|   0.03|   0.06|    0.13|    0.43|▇▃▂▁▁ |\n|concave_points_mean     |         0|             1|   0.05|   0.04|   0.00|   0.02|   0.03|    0.07|    0.20|▇▃▂▁▁ |\n|symmetry_mean           |         0|             1|   0.18|   0.03|   0.11|   0.16|   0.18|    0.20|    0.30|▁▇▅▁▁ |\n|fractal_dimension_mean  |         0|             1|   0.06|   0.01|   0.05|   0.06|   0.06|    0.07|    0.10|▆▇▂▁▁ |\n|radius_se               |         0|             1|   0.41|   0.28|   0.11|   0.23|   0.32|    0.48|    2.87|▇▁▁▁▁ |\n|texture_se              |         0|             1|   1.22|   0.55|   0.36|   0.83|   1.11|    1.47|    4.88|▇▅▁▁▁ |\n|perimeter_se            |         0|             1|   2.87|   2.02|   0.76|   1.61|   2.29|    3.36|   21.98|▇▁▁▁▁ |\n|area_se                 |         0|             1|  40.37|  45.52|   6.80|  17.85|  24.57|   45.24|  542.20|▇▁▁▁▁ |\n|smoothness_se           |         0|             1|   0.01|   0.00|   0.00|   0.01|   0.01|    0.01|    0.03|▇▃▁▁▁ |\n|compactness_se          |         0|             1|   0.03|   0.02|   0.00|   0.01|   0.02|    0.03|    0.14|▇▃▁▁▁ |\n|concavity_se            |         0|             1|   0.03|   0.03|   0.00|   0.02|   0.03|    0.04|    0.40|▇▁▁▁▁ |\n|concave_points_se       |         0|             1|   0.01|   0.01|   0.00|   0.01|   0.01|    0.01|    0.05|▇▇▁▁▁ |\n|symmetry_se             |         0|             1|   0.02|   0.01|   0.01|   0.02|   0.02|    0.02|    0.08|▇▃▁▁▁ |\n|fractal_dimension_se    |         0|             1|   0.00|   0.00|   0.00|   0.00|   0.00|    0.00|    0.03|▇▁▁▁▁ |\n|radius_worst            |         0|             1|  16.28|   4.83|   7.93|  13.02|  14.97|   18.79|   36.04|▆▇▃▁▁ |\n|texture_worst           |         0|             1|  25.67|   6.15|  12.02|  21.08|  25.41|   29.68|   49.54|▃▇▆▁▁ |\n|perimeter_worst         |         0|             1| 107.35|  33.57|  50.41|  84.15|  97.66|  125.53|  251.20|▇▇▃▁▁ |\n|area_worst              |         0|             1| 881.66| 569.28| 185.20| 515.68| 686.55| 1085.00| 4254.00|▇▂▁▁▁ |\n|smoothness_worst        |         0|             1|   0.13|   0.02|   0.07|   0.12|   0.13|    0.15|    0.22|▂▇▇▂▁ |\n|compactness_worst       |         0|             1|   0.25|   0.16|   0.03|   0.15|   0.21|    0.34|    1.06|▇▅▁▁▁ |\n|concavity_worst         |         0|             1|   0.27|   0.21|   0.00|   0.12|   0.23|    0.38|    1.25|▇▅▂▁▁ |\n|concave_points_worst    |         0|             1|   0.11|   0.07|   0.00|   0.06|   0.10|    0.16|    0.29|▅▇▅▃▁ |\n|symmetry_worst          |         0|             1|   0.29|   0.06|   0.16|   0.25|   0.28|    0.32|    0.66|▅▇▁▁▁ |\n|fractal_dimension_worst |         0|             1|   0.08|   0.02|   0.06|   0.07|   0.08|    0.09|    0.21|▇▃▁▁▁ |\n:::\n:::\n\n\nYa que tenemos una variable de salida categórica, haremos una exploración de los datos númericos y compararemos esos datos númericos asociados a las células benignas y malignas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwbc %>% pivot_longer(cols=-diagnosis, names_to = \"parametro\", values_to = \"valor\") %>% \n  ggplot(aes(diagnosis, valor, fill= diagnosis))+\n  geom_boxplot() + facet_wrap(~parametro, scales = \"free\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nAdicionalmente haremos la evaluación a través de ggpairs de GGally\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggpairs(wbc[1:8], aes(color = diagnosis))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nLa evaluación diagnostica permite diferenciar una clara separación entre células malignas y benignas asociada a los parametros descritos\n\n### Machine Learning con Tidymodels:\n\nAplicaremos el flujo de trabajo del ecositema Tidymodels:\n\n#### División de los datos en grupo de entrenamiento y prueba\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1970)\nwbc_split <- wbc %>% \n                 initial_split(prop = 0.75, strata = diagnosis)\n\nwbc_train <- training(wbc_split)\nwbc_test <- testing(wbc_split)\n\n#Evaluación de la dimensión de los dos grupos de datos\ndim(wbc_train)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 426  31\n```\n:::\n\n```{.r .cell-code}\ndim(wbc_test)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 142  31\n```\n:::\n:::\n\n\n### Feature Engeneerigng: Preparación de los datos para aplicación del algoritmo knn\n\n### ¿notas algo problemático en los\n\nRecuerda que el cálculo de la distancia para k-NN depende en gran medida de la escala de medición de las características de entrada.. Dado que la suavidad oscila entre 0,05 y 0,16 mientras que el área oscila entre 143,5 y 2501,0, el impacto del área será mucho mayor que el de la suavidad en el cálculo de la distancia.. Esto podría causar problemas para nuestro clasificador, así que vamos a aplicar la normalización para reescalar las características a un estándar usando el paquete recipes()\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Construir el recipe\n# Se usará la variable diagnosis como variable respuesta, los datos numéricos se normalizarán con step_normalize\nwbc_recipe <- recipe(diagnosis ~., data= wbc_train) %>% \n                  step_normalize(all_numeric()) #normalización\n\n#Imprimir el objeto wbc_recipe\nwbc_recipe\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRecipe\n\nInputs:\n\n      role #variables\n   outcome          1\n predictor         30\n\nOperations:\n\nCentering and scaling for all_numeric()\n```\n:::\n:::\n\n\nEl objeto recipe contiene los procedimientos que se aplicarán al conjunto de variables así como el papel de cada una de las variables cuando se aplique el algoritmo. El recipe debe prepararse y aplicar luego a los datos de entreanimiento y prueba\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwbc_recipe_prep <- wbc_recipe %>% \n  prep(training = wbc_train)\n\n#Baking\nwbc_training_baked <- wbc_recipe_prep %>% \n  bake(new_data = NULL)\n\n#Datos de entrenamiento normalizados\nwbc_training_baked  %>% glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 426\nColumns: 31\n$ radius_mean             <dbl> -0.1695881, -0.3014030, -1.3261198, -0.3157306…\n$ texture_mean            <dbl> -1.1222690, -0.8194853, -1.5528948, -0.2116749…\n$ perimeter_mean          <dbl> -0.1884909, -0.2646714, -1.3174604, -0.3903899…\n$ area_mean               <dbl> -0.251162420, -0.382978983, -1.083628145, -0.3…\n$ smoothness_mean         <dbl> 0.12867392, 0.81233997, 0.45325688, -0.4317773…\n$ compactness_mean        <dbl> -0.4365584, 0.4310362, -0.7472677, -1.2646738,…\n$ concavity_mean          <dbl> -0.2859009, -0.5474374, -0.7485810, -0.7977439…\n$ concave_points_mean     <dbl> -0.02877076, -0.46226312, -0.73050436, -0.5107…\n$ symmetry_mean           <dbl> 0.293353263, 0.599154999, 0.032303000, -1.2654…\n$ fractal_dimension_mean  <dbl> -0.70969400, 0.73804585, 0.86827317, -0.575310…\n$ radius_se               <dbl> -0.46481050, -0.76647420, -0.43845500, -0.7711…\n$ texture_se              <dbl> -0.75450252, -0.82872674, -0.41296224, 2.06456…\n$ perimeter_se            <dbl> -0.37735994, -0.70475776, -0.44962998, -0.8080…\n$ area_se                 <dbl> -0.34735388, -0.53595857, -0.51410673, -0.5467…\n$ smoothness_se           <dbl> 0.55631329, -0.93930882, 0.94829306, -0.851935…\n$ compactness_se          <dbl> -0.6250921, -0.3703322, -0.6413781, -1.1893445…\n$ concavity_se            <dbl> -0.2661595, -0.4815811, -0.3918482, -0.5925748…\n$ concave_points_se       <dbl> 0.211472264, -0.835956215, 0.378180100, -0.026…\n$ symmetry_se             <dbl> -0.058771027, -0.444403061, 0.001244554, 0.823…\n$ fractal_dimension_se    <dbl> -0.5510642, -0.5046197, -0.3028652, -0.7453876…\n$ radius_worst            <dbl> -0.24482758, -0.37141214, -1.25750408, -0.6204…\n$ texture_worst           <dbl> -1.03345162, -0.83874932, -1.60331201, -0.4715…\n$ perimeter_worst         <dbl> -0.22923319, -0.33699461, -1.26117565, -0.6841…\n$ area_worst              <dbl> -0.29772223, -0.43832718, -0.98820230, -0.5857…\n$ smoothness_worst        <dbl> 0.525580669, -0.023824905, 0.027681868, -1.491…\n$ compactness_worst       <dbl> -0.5051461, 0.1326670, -0.9025870, -1.3388817,…\n$ concavity_worst         <dbl> -0.18440526, -0.41943689, -0.89105137, -1.0806…\n$ concave_points_worst    <dbl> 0.2081505, -0.6518532, -0.8141122, -1.0006487,…\n$ symmetry_worst          <dbl> 0.12140300, 0.45504464, -0.72801315, -1.474274…\n$ fractal_dimension_worst <dbl> -0.63308242, -0.13651592, -0.35685387, -1.2188…\n$ diagnosis               <fct> B, B, B, B, B, B, B, B, B, B, B, B, B, B, B, B…\n```\n:::\n\n```{.r .cell-code}\n#Datos de prueba normalizados\nwbc_test_baked <- wbc_recipe_prep %>% \n  bake(new_data = wbc_test)\n\nwbc_test_baked %>% glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 142\nColumns: 31\n$ radius_mean             <dbl> 1.59271860, 1.18008093, 0.47229269, -0.1151428…\n$ texture_mean            <dbl> 0.42304963, 0.13820860, -0.33054553, 0.7280762…\n$ perimeter_mean          <dbl> 1.58239267, 1.14945452, 0.48339582, 0.06710913…\n$ area_mean               <dbl> 1.56152885, 1.09746622, 0.36009063, -0.2169983…\n$ smoothness_mean         <dbl> 0.960197715, -0.093816780, 0.080092091, 1.2066…\n$ compactness_mean        <dbl> 1.055491792, 0.089388829, 0.472793148, 2.37273…\n$ concavity_mean          <dbl> 1.34570790, 0.28883070, 0.12462169, 1.53786739…\n$ concave_points_mean     <dbl> 2.04893144, 0.65065265, 0.44467243, 0.81279073…\n$ symmetry_mean           <dbl> 0.97954252, -0.04601208, 0.13299382, 0.9795425…\n$ fractal_dimension_mean  <dbl> -0.38689650, -0.74294353, -0.27190855, 1.94472…\n$ radius_se               <dbl> 1.22942116, 0.16487240, 0.37536030, -0.6706683…\n$ texture_se              <dbl> -0.75758764, -0.78245003, -0.39826258, -0.0641…\n$ perimeter_se            <dbl> 0.84832048, 0.16684799, 0.35310097, -0.3759048…\n$ area_se                 <dbl> 1.14769368, 0.29653279, 0.30183663, -0.4396407…\n$ smoothness_se           <dbl> -0.23586960, -0.86495601, -0.36573003, -0.1402…\n$ compactness_se          <dbl> 0.85577249, -0.67046030, 0.88776289, 1.9783446…\n$ concavity_se            <dbl> 0.18563169, -0.30774308, -0.13984558, 0.707458…\n$ concave_points_se       <dbl> 1.379999832, -0.222597196, 0.159572655, 0.7037…\n$ symmetry_se             <dbl> 0.285999334, -0.838973585, -0.023017064, -0.08…\n$ fractal_dimension_se    <dbl> 0.29273811, -0.59602237, 0.13408396, 1.6013561…\n$ radius_worst            <dbl> 1.51075504, 1.36756922, 0.85708066, -0.2614288…\n$ texture_worst           <dbl> -0.04094478, 0.29622261, 0.23607069, 0.9848039…\n$ perimeter_worst         <dbl> 1.34688951, 1.36778508, 0.86927657, 0.04240917…\n$ area_worst              <dbl> 1.44076126, 1.26130265, 0.72641146, -0.3212435…\n$ smoothness_worst        <dbl> 0.54274959, 0.53416513, 0.33672250, 1.43124142…\n$ compactness_worst       <dbl> 1.066812087, 0.005485953, 1.934187070, 3.27976…\n$ concavity_worst         <dbl> 0.80930849, 0.47086294, 0.55594439, 1.95579280…\n$ concave_points_worst    <dbl> 1.9628836, 1.1976847, 1.0102264, 1.6217709, 0.…\n$ symmetry_worst          <dbl> 1.1465048, 0.2600174, 1.4350162, 1.1191043, 0.…\n$ fractal_dimension_worst <dbl> 0.17249461, -0.03709514, 1.09791399, 3.1561928…\n$ diagnosis               <fct> M, M, M, M, M, M, M, M, M, M, M, M, B, B, B, B…\n```\n:::\n:::\n\n\n### Construccón del modelo de clasificación knn\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Se especifica el modelo\nknn_model <- nearest_neighbor(neighbors = 21) %>% \n  set_engine(\"kknn\") %>% \n  set_mode(\"classification\")\n\n\nknn_model\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nK-Nearest Neighbor Model Specification (classification)\n\nMain Arguments:\n  neighbors = 21\n\nComputational engine: kknn \n```\n:::\n:::\n\n\n#### Ajuste del modelo a los datos de entrenamiento\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknn_fit <- knn_model %>% \n             fit(diagnosis~., data= wbc_training_baked)\n\nknn_fit\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nparsnip model object\n\n\nCall:\nkknn::train.kknn(formula = diagnosis ~ ., data = data, ks = min_rows(21,     data, 5))\n\nType of response variable: nominal\nMinimal misclassification: 0.03286385\nBest kernel: optimal\nBest k: 21\n```\n:::\n:::\n\n\n### Evaluación de la predicción del modelo\n\nSe predicen las clases suministrando la información de los datos de entrenamiento\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclases_preds <- predict(knn_fit, new_data = wbc_test_baked,\n                        type = \"class\")\nclases_preds\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 142 × 1\n   .pred_class\n   <fct>      \n 1 M          \n 2 M          \n 3 M          \n 4 M          \n 5 M          \n 6 M          \n 7 M          \n 8 M          \n 9 M          \n10 M          \n# … with 132 more rows\n```\n:::\n:::\n\n\nSe predicen las probabilidades\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprob_preds <- predict(knn_fit, new_data = wbc_test_baked,\n                        type = \"prob\")\n\nprob_preds\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 142 × 2\n   .pred_M .pred_B\n     <dbl>   <dbl>\n 1   1      0     \n 2   1      0     \n 3   0.955  0.0453\n 4   0.965  0.0351\n 5   0.836  0.164 \n 6   1      0     \n 7   1      0     \n 8   1      0     \n 9   1      0     \n10   0.689  0.311 \n# … with 132 more rows\n```\n:::\n:::\n\n\n### Métricas del modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#se crea una data.frame/tibble de resultados conteniendo los valores actuales (truth) y los valores predichos del modelo como clases y probabilidades\n\nresultados <- wbc_test %>% select(diagnosis) %>% \n                bind_cols(clases_preds) %>% \n                bind_cols(prob_preds)\n\nresultados\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 142 × 4\n   diagnosis .pred_class .pred_M .pred_B\n   <fct>     <fct>         <dbl>   <dbl>\n 1 M         M             1      0     \n 2 M         M             1      0     \n 3 M         M             0.955  0.0453\n 4 M         M             0.965  0.0351\n 5 M         M             0.836  0.164 \n 6 M         M             1      0     \n 7 M         M             1      0     \n 8 M         M             1      0     \n 9 M         M             1      0     \n10 M         M             0.689  0.311 \n# … with 132 more rows\n```\n:::\n:::\n\n\n#### Matriz de Confusión\n\n\n::: {.cell}\n\n```{.r .cell-code}\nconf_mat(resultados, truth = diagnosis, estimate = .pred_class) %>% autoplot(\"heatmap\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n#### Accurracy , Área bajo la curva, sensibilidad y especificidad\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmetricas_wbc <- metric_set(accuracy, roc_auc, sens, specificity)\n\n\nmetricas_wbc(resultados, truth = diagnosis, estimate = .pred_class, .pred_M)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 3\n  .metric     .estimator .estimate\n  <chr>       <chr>          <dbl>\n1 accuracy    binary         0.972\n2 sens        binary         0.925\n3 specificity binary         1    \n4 roc_auc     binary         0.997\n```\n:::\n:::\n\n\n### Curva ROC\n\nUna **curva ROC** (acrónimo de ***Receiver Operating Characteristic***, o Característica Operativa del Receptor) es una representación gráfica de la sensibilidad frente a la especificidad para un sistema clasificador [binario](https://es.wikipedia.org/wiki/Sistema_binario \"Sistema binario\") según se varía el umbral de discriminación.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroc_curve(resultados, truth = diagnosis, estimate = .pred_M) %>% autoplot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n## Conclusiones\n\nEl algoritmo k-nearest neighbor (k-NN) es uno de los más simples y más utilizados en el aprendizaje automático. En este jemplo práctico se muestra una buena predicción del modelo, sin embargo, aunque es fácil de entender e implementar, tiene algunas desventajas:\n\nEl rendimiento del k-NN puede ser lento en grandes conjuntos de datos debido a la necesidad de almacenar todo el conjunto de datos y calcular la distancia para cada instancia de prueba durante la clasificación.\n\nEl k-NN es sensible a la escala de las características. Las características con una escala más grande tendrán un mayor peso en la distancia y, por lo tanto, tendrán un mayor impacto en la clasificación. Esto puede llevar a resultados no deseados si no se preprocesan adecuadamente los datos.\n\nEl k-NN no proporciona una forma de ajustar la complejidad del modelo. El valor de k se elige de forma empírica y no hay una manera de saber cuál es el mejor valor para k sin probar varios valores diferentes.\n\nEl k-NN es propenso a la interferencia de ruido en los datos. Las instancias de ruido o outliers pueden tener un gran impacto en los vecinos más cercanos y, por lo tanto, en la clasificación.\n\nEl k-NN no proporciona una representación explícita de los patrones en los datos. Aunque es útil para hacer predicciones, no proporciona una comprensión de cómo se realizan las prediccio.\n\nAquí usamos un criterio empírico paa elegir el valor de k vecinos, es importante considerar otras aproximaciones ya que la aproximación empírica se basa en la experiencia de ciertos conjunto de datos. Por otra parte se hizo una partición de los datos basados en un solo conjunto de entrenamiento y un conjunto de prueba; esto puede limitar el desarrollo del modelo por lo que es importante considerar otras aproximaciones que presentaremos en otra sección\n\n## Bibliografía \n\n1.   [Fix](https://es.wikipedia.org/wiki/Evelyn_Fix \"Evelyn Fix\"), E.; Hodges, J.L. (1989). «(1951): An Important Contribution to Nonparametric Discriminant Analysis and Density Estimation: Commentary on [Fix](https://es.wikipedia.org/wiki/Evelyn_Fix \"Evelyn Fix\") and Hodges (1951)». *International Statistical Review / Revue Internationale de Statistique* **57** (3): 233-238. [doi](https://es.wikipedia.org/wiki/Digital_object_identifier \"Digital object identifier\"):[10.2307/1403796](https://dx.doi.org/10.2307%2F1403796)..\n\n2.  [↑](https://es.wikipedia.org/wiki/K_vecinos_m%C3%A1s_pr%C3%B3ximos#cite_ref-2 \"Volver arriba\") Piryonesi, S. Madeh; El-Diraby, Tamer E. (2020-06). [«Role of Data Analytics in Infrastructure Asset Management: Overcoming Data Size and Quality Problems»](http://ascelibrary.org/doi/10.1061/JPEODX.0000175). *Journal of Transportation Engineering, Part B: Pavements* (en inglés) **146** (2): 04020022. [ISSN](https://es.wikipedia.org/wiki/ISSN \"ISSN\") [2573-5438](https://portal.issn.org/resource/issn/2573-5438). [doi](https://es.wikipedia.org/wiki/Digital_object_identifier \"Digital object identifier\"):[10.1061/JPEODX.0000175](https://dx.doi.org/10.1061%2FJPEODX.0000175). Consultado el 7 de agosto de 2020.\n\n3.  [↑](https://es.wikipedia.org/wiki/K_vecinos_m%C3%A1s_pr%C3%B3ximos#cite_ref-3 \"Volver arriba\") Hastie, Trevor.; Friedman, J. H. (Jerome H.) (2001). [*The elements of statistical learning : data mining, inference, and prediction : with 200 full-color illustrations*](https://www.worldcat.org/oclc/46809224). Springer. [ISBN](https://es.wikipedia.org/wiki/ISBN \"ISBN\") [0-387-95284-5](https://es.wikipedia.org/wiki/Especial:FuentesDeLibros/0-387-95284-5 \"Especial:FuentesDeLibros/0-387-95284-5\"). [OCLC](https://es.wikipedia.org/wiki/OCLC \"OCLC\") [46809224](https://www.worldcat.org/oclc/46809224). Consultado el 7 de agosto de 2020.\n\n4.  Kuhn, M., & Silge, J. (2022). *Tidy Modeling with R*. \" O'Reilly Media, Inc.\".<https://www.tidymodels.org/books/>\n\n5.  Ismail Taha and Joydeep Ghosh. [Characterization of the Wisconsin Breast cancer Database Using a Hybrid Symbolic-Connectionist System](http://rexa.info/paper/9f9df113476ffbf356892bb497bd2714e6f56d99). Proceedings of ANNIE. 1996\n\n\n\n\n\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}